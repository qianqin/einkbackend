name: "trmnl"

services:
  app:
    image: ghcr.io/usetrmnl/byos_laravel:latest
    ports:
      - "${APP_PORT:-2300}:8080"
    environment:
      APP_KEY: ${APP_KEY}
      APP_URL: https://dashboard.qin.berlin
      APP_TIMEZONE: ${APP_TIMEZONE:-Europe/Berlin}
      PHP_OPCACHE_ENABLE: 1
      FORCE_HTTPS: 1
      TRUSTED_PROXIES: "*"
      REGISTRATION_ENABLED: 0
      DB_DATABASE: database/storage/database.sqlite
    volumes:
      - database:/var/www/html/database/storage
      - storage:/var/www/html/storage/app/public/images/generated
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "curl --fail --silent http://localhost:8080/up"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    deploy:
      resources:
        limits:
          memory: 1G
          cpus: "1.0"

volumes:
  database:
  storage:
